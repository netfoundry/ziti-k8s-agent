---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: zitiwebhooks.kubernetes.openziti.io
spec:
  group: kubernetes.openziti.io
  names:
    kind: ZitiWebhook
    listKind: ZitiWebhookList
    plural: zitiwebhooks
    singular: zitiwebhook
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ZitiWebhook is the Schema for the zitiwebhooks API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ZitiWebhookSpec defines the desired state of ZitiWebhook
            properties:
              adminJwt:
                description: Ziti Admin Idetity Token
                type: string
              cert:
                description: Webhook Certificate
                properties:
                  duration:
                    default: 2160
                    description: Cert Duration
                    format: int64
                    type: integer
                  organization:
                    default:
                    - netfoundry
                    description: Cert Organization
                    items:
                      type: string
                    type: array
                  renewBefore:
                    default: 360
                    description: Cert Renew Before
                    format: int64
                    type: integer
                type: object
              clusterRoleBindingSpec:
                description: Cluster Role Binding Specs
                items:
                  type: object
                type: array
              clusterRoleSpec:
                default:
                - apiGroups:
                  - '*'
                  resources:
                  - services
                  - namespaces
                  verbs:
                  - get
                  - list
                  - watch
                description: Cluster Role Specs
                items:
                  properties:
                    apiGroups:
                      default:
                      - '*'
                      description: Api Group List
                      items:
                        type: string
                      minItems: 1
                      type: array
                    resources:
                      default:
                      - services
                      - namespaces
                      description: Resources List
                      items:
                        type: string
                      minItems: 1
                      type: array
                    verbs:
                      default:
                      - get
                      - list
                      - watch
                      description: Verbs List
                      items:
                        type: string
                      minItems: 1
                      type: array
                  required:
                  - apiGroups
                  - resources
                  - verbs
                  type: object
                minItems: 1
                type: array
              deploymentSpec:
                description: Deployment Specs
                properties:
                  clusterDnsServiceIP:
                    description: Cluster DNS Service IP
                    type: string
                  image:
                    default: netfoundry/ziti-k8s-agent
                    description: Webhook Image
                    type: string
                  imagePullPolicy:
                    default: IfNotPresent
                    description: Weebhook Image Pull Policy
                    type: string
                  imageVersion:
                    default: latest
                    description: Webhook Image Version
                    type: string
                  logLevel:
                    default: 2
                    description: Log Verbose Level
                    format: int32
                    maximum: 5
                    minimum: 0
                    type: integer
                  podSecurityOverride:
                    default: false
                    description: 'Override the security context at pod level, i.e.
                      runAsNonRoot: false'
                    type: boolean
                  port:
                    default: 9443
                    description: Secure port that the webhook listens on
                    format: int32
                    type: integer
                  replicas:
                    default: 1
                    description: Number of replicas
                    format: int32
                    type: integer
                  resourceLimit:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    default:
                      cpu: 500m
                      memory: 512Mi
                    description: Resource Limit
                    type: object
                  resourceRequest:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    default:
                      cpu: 100m
                      memory: 128Mi
                    description: Resource Request
                    type: object
                  searchDomainList:
                    description: A list of DNS search domains as space seperated string
                      i.e. 'value1 value2'
                    type: string
                  sidecarIdentityDir:
                    default: /ziti-tunnel
                    description: Directory where sidecar container will store identity
                      files
                    type: string
                  sidecarImage:
                    default: openziti/ziti-tunnel
                    description: Sidecar container image
                    type: string
                  sidecarImagePullPolicy:
                    default: IfNotPresent
                    description: Image pull policy for sidecar container
                    type: string
                  sidecarImageVersion:
                    default: latest
                    description: Sidecar container image version
                    type: string
                  sidecarPrefix:
                    default: zt
                    description: Used in creation of ContainerName to be used as injected
                      sidecar
                    type: string
                  zitiCtrlCaBundleFile:
                    description: Ziti Controller CA Bundle
                    type: string
                  zitiCtrlClientCertFile:
                    description: Ziti Controller Client Certificate
                    type: string
                  zitiCtrlClientKeyFile:
                    description: Ziti Controller Client Key
                    type: string
                  zitiCtrlMgmtApi:
                    default: https://ziti-controller:1280/edge/management/v1
                    description: Ziti Controller Management URL, i.e. https://{FQDN}:{PORT}/edge/management/v1
                    type: string
                  zitiRoleKey:
                    default: identity.openziti.io/role-attributes
                    description: Ziti Identity Role Key used in pod annotation
                    type: string
                type: object
              name:
                description: Webhook Name
                type: string
              webhookSpec:
                description: Webhook Specs
                properties:
                  clientConfig:
                    description: Webhook Client Config
                    properties:
                      caBundle:
                        default: ""
                        description: Webhook Service Ca Bundle
                        type: string
                      namespace:
                        description: Webhook Service Namespace
                        type: string
                      path:
                        default: /ziti-tunnel
                        description: Webhook Service Path
                        type: string
                      port:
                        default: 443
                        description: Webhook Service Port
                        format: int32
                        type: integer
                      serviceName:
                        description: Webhook Service Name
                        type: string
                    type: object
                  failurePolicy:
                    default: Fail
                    description: Webhook Failure Policy
                    enum:
                    - Ignore
                    - Fail
                    type: string
                  matchPolicy:
                    default: Equivalent
                    description: Webhook Match Policy
                    enum:
                    - Exact
                    - Equivalent
                    type: string
                  routerSelectorKey:
                    default: router.openziti.io/enabled
                    description: Namespace / Pod Label Selector Key to enable the
                      sidecar injection
                    type: string
                  rules:
                    description: Webhook Rules
                    items:
                      description: |-
                        RuleWithOperations is a tuple of Operations and Resources. It is recommended to make
                        sure that all the tuple expansions are valid.
                      properties:
                        apiGroups:
                          description: |-
                            APIGroups is the API groups the resources belong to. '*' is all groups.
                            If '*' is present, the length of the slice must be one.
                            Required.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                        apiVersions:
                          description: |-
                            APIVersions is the API versions the resources belong to. '*' is all versions.
                            If '*' is present, the length of the slice must be one.
                            Required.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                        operations:
                          description: |-
                            Operations is the operations the admission hook cares about - CREATE, UPDATE, DELETE, CONNECT or *
                            for all of those operations and any future admission operations that are added.
                            If '*' is present, the length of the slice must be one.
                            Required.
                          items:
                            description: OperationType specifies an operation for
                              a request.
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                        resources:
                          description: |-
                            Resources is a list of resources this rule applies to.

                            For example:
                            'pods' means pods.
                            'pods/log' means the log subresource of pods.
                            '*' means all resources, but not subresources.
                            'pods/*' means all subresources of pods.
                            '*/scale' means all scale subresources.
                            '*/*' means all resources and their subresources.

                            If wildcard is present, the validation rule will ensure resources do not
                            overlap with each other.

                            Depending on the enclosing object, subresources might not be allowed.
                            Required.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                        scope:
                          description: |-
                            scope specifies the scope of this rule.
                            Valid values are "Cluster", "Namespaced", and "*"
                            "Cluster" means that only cluster-scoped resources will match this rule.
                            Namespace API objects are cluster-scoped.
                            "Namespaced" means that only namespaced resources will match this rule.
                            "*" means that there are no scope restrictions.
                            Subresources match the scope of their parent resource.
                            Default is "*".
                          type: string
                      type: object
                    minItems: 1
                    type: array
                  selectorType:
                    default: Namespace
                    description: Selector Type
                    enum:
                    - Namespace
                    - Pod
                    type: string
                  sideEffectType:
                    default: None
                    description: Webhook Side EfFect
                    enum:
                    - None
                    - Unknown
                    - Some
                    - NoneOnDryRun
                    type: string
                  timeoutSeconds:
                    default: 30
                    description: Webhook Timeout
                    format: int32
                    type: integer
                  tunnelSelectorKey:
                    default: tunnel.openziti.io/enabled
                    description: Namespace / Pod Label Selector Key to enable the
                      sidecar injection
                    type: string
                  webhookSelectorValues:
                    default:
                    - "true"
                    - "false"
                    description: PodMutatorSelectorValues is the list of values used
                      to select the pod mutator
                    items:
                      type: string
                    type: array
                type: object
            required:
            - clusterRoleSpec
            type: object
          status:
            description: ZitiWebhookStatus defines the observed state of ZitiWebhook
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
